<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Excel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        th, td {
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <h2 class="text-center mb-4">ğŸ“Š Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù„Ù Excel</h2>

    <!-- âœ… Ø²Ø±ÙŠÙ† Ø§Ù„ØªØµØ¯ÙŠØ± -->
    <div class="text-center mb-4">
        <a href="{{ url_for('clients.export_uploaded_file') }}" class="btn btn-success me-2">
            ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„Ù ÙƒÙ…Ø§ Ù‡Ùˆ
        </a>
        <a href="{{ url_for('clients.export_uploaded_file_nonempty') }}" class="btn btn-warning">
            ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·
        </a>
    </div>

    <!-- âœ… Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« -->
    <div class="mb-3 text-center">
        
    <div class="input-group w-75 mx-auto mb-3">
        <input type="text" id="searchInput" class="form-control" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..." onkeyup="debouncedFilterTable()">
        <select id="columnSelector" class="form-select" style="max-width: 200px;">
            <option value="all">ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙƒÙ„</option>
            {% for head in headers %}
                <option value="{{ loop.index0 }}">{{ head }}</option>
            {% endfor %}
        </select>
    </div>
    
    </div>

    <!-- âœ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
    <div class="table-responsive bg-white p-3 rounded shadow-sm">
        <table class="table table-bordered">
            <thead class="table-dark">
                <tr>
                    {% for head in headers %}
                        <th>{{ head }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                    <tr>
                        {% for cell in row %}
                            <td>{{ cell }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- âœ… Ø³ÙƒØ±Ø¨Øª Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Debounce Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªÙ‡Ù†ÙŠØ¬ -->
<script>
let debounceTimer;
function debouncedFilterTable() {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
        let input = document.getElementById("searchInput");
        let filter = input.value.toLowerCase();
        let table = document.querySelector("table");
        let rows = table.getElementsByTagName("tr");

        for (let i = 1; i < rows.length; i++) {
            let cells = rows[i].getElementsByTagName("td");
            let match = false;

            for (let j = 0; j < cells.length; j++) {
                if (cells[j].innerText.toLowerCase().includes(filter)) {
                    match = true;
                    break;
                }
            }

            rows[i].style.display = match ? "" : "none";
        }
    }, 500); // ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„ÙÙ„ØªØ±Ø© Ø¨Ø¹Ø¯ 0.5 Ø«Ø§Ù†ÙŠØ© Ù…Ù† Ø¢Ø®Ø± Ø­Ø±Ù
}

function debouncedFilterTable() {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let columnIndex = document.getElementById("columnSelector").value;
        let table = document.querySelector("table");
        let rows = table.querySelectorAll("tbody tr");

        rows.forEach(row => {
            let cells = row.querySelectorAll("td");
            let showRow = false;

            if (columnIndex === "all") {
                showRow = Array.from(cells).some(cell => cell.textContent.toLowerCase().includes(input));
            } else {
                let cell = cells[parseInt(columnIndex)];
                if (cell && cell.textContent.toLowerCase().includes(input)) {
                    showRow = true;
                }
            }

            row.style.display = showRow ? "" : "none";
        });

        hideEmptyColumns();
    }, 300);
}

function hideEmptyColumns() {
    let table = document.querySelector("table");
    let rows = table.querySelectorAll("tbody tr");
    let headers = table.querySelectorAll("thead th");

    if (rows.length === 0) return;

    let colCount = headers.length;

    for (let col = 0; col < colCount; col++) {
        let empty = true;
        for (let row of rows) {
            if (row.style.display === "none") continue;
            let cell = row.children[col];
            if (cell && cell.textContent.trim() !== "") {
                empty = false;
                break;
            }
        }
        for (let row of table.rows) {
            if (row.cells[col]) {
                row.cells[col].style.display = empty ? "none" : "";
            }
        }
    }
}

// Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©: Ø£Ø®ÙÙ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ÙØ§Ø±ØºØ© Ø£ÙˆÙ„Ø§Ù‹
window.onload = function() {
    hideEmptyColumns();
};
</script>
